<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RP-Event Kalender</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #calendar { max-width: 800px; margin: 40px auto; }
    </style>
</head>
<body>
    <h1>ðŸ“… RP-Event Kalender</h1>
    <p>Neue Termine kÃ¶nnen direkt im Kalender erstellt werden. Teilnehmer kÃ¶nnen sich eintragen!</p>
    <div id="calendar"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let calendarEl = document.getElementById('calendar');
            let sheetUrl = "https://script.google.com/macros/s/AKfycbwvRvt6rt_6cqHIWSZB7SWDo3hWtHi6HHu9goo2E_YzOfoSC0IykkBy_PBufDI5kJxn/exec";

            async function fetchEvents() {
                let response = await fetch(sheetUrl + "?action=get");
                return await response.json();
            }

            async function updateEvent(eventTitle, userName) {
                let response = await fetch(sheetUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ action: "update", event: eventTitle, name: userName })
                });
                let result = await response.text();
                alert(result);
            }

            async function createEvent(eventTitle, eventDate, eventTime) {
                let response = await fetch(sheetUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ action: "create", title: eventTitle, date: eventDate, time: eventTime })
                });
                let result = await response.text();
                alert(result);
                location.reload();
            }

            fetchEvents().then(events => {
                let calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    editable: true,
                    selectable: true,
                    events: events,
                    select: function(info) {
                        let title = prompt("Gib den Event-Titel ein:");
                        let time = prompt("Gib die Uhrzeit ein (HH:MM):");
                        if (title && time) {
                            createEvent(title, info.startStr, time);
                        }
                    },
                    eventClick: function(info) {
                        let name = prompt('Gib deinen Namen ein, um dich fÃ¼r dieses Event anzumelden:');
                        if (name) {
                            updateEvent(info.event.title, name);
                        }
                    }
                });
                calendar.render();
            });
        });
    </script>
</body>
</html>
